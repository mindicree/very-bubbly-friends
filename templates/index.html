<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Very Bubbly Friends!</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dist/app.css') }}">
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js" integrity="sha384-Gr6Lu2Ajx28mzwyVR8CFkULdCU7kMlZ9UthllibdOSo6qAiN+yXNHqtgdTvFXMT4" crossorigin="anonymous"></script>
</head>
<body>
    <div x-data="game" class="flex flex-col w-full min-h-screen bg-gradient-to-b from-cyan-300 to-pink-400 text-white font-bubble relative">
        <!-- BACKGROUND IMAGE BUBBLES FROM DREW BEAMER https://unsplash.com/photos/green-blue-and-pink-bubbles-Hk6E4UxjmGo -->
        <div class="absolute top-0 left-0 bg-cover bg-center w-full h-screen opacity-0 transition ease-in-out duration-[5000ms]" :class="{ 'opacity-5': true, 'opacity-0': false }" style="background-image: url('https://images.unsplash.com/photo-1594035519981-62c9cef33ca9?q=80&w=2071&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');"></div>
        
        <!-- LOADING SCENE -->
        <div class="scene" x-bind:class="isCurrentScene('loading') ? 'scene-active' : 'scene-inactive'">
            <span class="m-auto">Loading...</h1>
        </div>

        <!-- HOME SCENE -->
        <div class="scene" x-bind:class="isCurrentScene('home') ? 'scene-active' : 'scene-inactive'">
            <div class="flex flex-col gap-12 justify-end h-1/2 m-auto">
                <div class="flex flex-col m-auto gap-6 md:gap-8">
                    <h1 class="m-auto text-3xl md:text-6xl text-shadow text-center" style="text-shadow: 0.5rem 0.5rem 1rem black;">Very Bubbly Friends!</h1>
                    <h2 class="m-auto text-xl md:text-2xl text-center max-w-screen-sm" style="text-shadow: 0.5rem 0.5rem 1rem black;">The Bubbliest Trivia Game Around!</h2>
                </div>
                <div class="flex flex-col gap-4 m-auto w-full">
                    <div class="flex flex-col md:flex-row gap-4 m-auto w-full md:py-4">
                        <button @click="$refs.modalJoinGame.showModal()" class="md:text-4xl md:p-6">Join</button>
                        <span class="hidden md:inline my-auto text-4xl">OR</span>
                        <button @click="$refs.modalCreateGame.showModal()" class="md:text-4xl md:p-6">Create</button>
                    </div>
                    <button @click="$refs.modalHowToPlay.showModal()">How To Play</button>
                    <button @click="$refs.modalCredits.showModal()">Credit</button>
                </div>
            </div>
        </div>

        <!-- GAME LIST -->
        <div class="scene" x-bind:class="isCurrentScene('gameList') ? 'scene-active' : 'scene-inactive'">
            <div class="flex flex-col w-full h-screen relative">
                <div class="m-auto w-11/12 max-w-screen-xl min-h-[90vh] bg-cyan-400 border-2 border-cyan-500 drop-shadow-lg flex flex-col gap-8 relative">
                    <h3 class="text-xl md:text-4xl text-center my-3 mx-auto">Games</h3>
                    <div class="flex w-full overflow-y-scroll max-h-[80vh] mx-auto scroll relative">
                        <table class="w-full mx-auto">
                            <thead class="sticky top-0">
                                <tr class="bg-cyan-800">
                                    <th class="text-sm md:text-base min-w-32 text-left py-3  pl-3">Name</th>
                                    <th class="text-sm md:text-base w-20 md:w-32 text-center py-3">Pl<span class="hidden md:inline">ayers</span></th>
                                    <th class="text-sm md:text-base w-20 md:w-32 text-center py-3">R<span class="hidden md:inline">oun</span>ds</th>
                                    <th class="text-sm md:text-base w-20 md:w-32 text-center py-3"><span class="hidden md:inline">Round </span>Dur<span class="hidden md:inline">ation</span></th>
                                    <th class="text-sm md:text-base min-w-14 md:w-20 lg:w-44 text-center py-3"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="game in gameList">
                                    <tr class="odd:bg-cyan-500 even:bg-cyan-600">
                                        <td class="text-sm md:text-base text-left py-3 pl-3">
                                            <span x-text="game.name" class="my-auto"></span>
                                            <template x-if="game.password">
                                                <span class="my-auto">
                                                    &#x1F512;
                                                </span>
                                            </template>
                                        </td>
                                        <td class="text-sm md:text-base text-center py-3" x-text="`${pad(game.players.length,2)}/${game.max_players}`"></td>
                                        <td class="text-sm md:text-base text-center py-3 " x-text="pad(game.rounds, 2)"></td>
                                        <td class="text-sm md:text-base text-center py-3" x-text="pad(game.round_duration, 3)"></td>
                                        <td class="text-sm md:text-base text-center py-3">
                                            <button class="text-xs md:text-base min-w-12 md:min-w-20 lg:min-w-40" x-on:click="joinGame(game)" x-bind:disabled="game.players.length === game.max_players">Join</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- LOBBY -->
        <div class="scene" x-bind:class="isCurrentScene('lobby') ? 'scene-active' : 'scene-inactive'">
            <template x-if="gameState">
                <div class="flex flex-col w-full h-screen relative">
                    <div class="m-auto w-11/12 max-w-screen-xl min-h-[90vh] bg-cyan-400 border-2 border-cyan-500 drop-shadow-lg flex flex-col gap-8 relative mx-auto">
                        <h3 class="text-xl md:text-4xl text-center my-3 mx-auto" x-text="gameState.name"></h3>
                        <div class="flex flex-wrap gap-12 max-h-[50vh] scroll">
                            <template x-for="player in gameState.players">
                                <span x-text="player.name"></span>
                            </template>
                        </div>
                        <div class="absolute bottom-3 w-full flex">
                            <template x-if="gameCreator">
                                <button x-bind:disabled="gameState.players.length <= 0" class="mx-auto">Start</button>
                            </template>
                            <!-- TODO add cancel button -->
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- MODALS -->
        <dialog x-ref="modalJoinGame" class="max-w-screen-sm">
            <div class="flex text-white">
                <div class="flex flex-col p-6 w-full h-full gap-2 md:gap-3">
                    <div class="flex flex-row justify-between w-full">
                        <h4 class="bold text-xl md:text-4xl my-auto">Hi Bubble Buddy!</h4>
                        <button x-on:click="$refs.modalJoinGame.close()" class="rounded-full bg-none lg:opacity-50 lg:hover:opacity-100 min-w-0 w-12 h-12 mr-0 text-lg">
                            X
                        </button>
                    </div>
                    <hr>
                    <div class="min-h-[50hv] h-[10000px] max-h-[65vh] md:h-fit md:max-h-[55vh] overflow-y-scroll md:overflow-y-auto">
                        <form id="newPlayerForm" class="flex flex-col gap-4 relative w-full">
                            <div class="flex flex-col gap-2 w-full">
                                <label for="new-player-name" class="my-auto">Name</label>
                                <div class="w-full flex flex-row gap-4">
                                    <input id="new-player-name" x-model="player.name" maxlength="32" class="w-full" x-bind:disabled="loading">
                                </div>
                            </div>
                        </form>
                    </div>
                    <hr>
                    <div class="w-full flex flex-row justify-between m-auto">
                        <div></div>
                        <button x-on:click="createNewPlayer()" x-bind:disabled="loading">Games</button>
                    </div>
                </div>
            </div>
        </dialog>

        <dialog x-ref="modalCreateGame">
            <div class="flex text-white">
                <div class="flex flex-col p-6 w-full h-full gap-2 md:gap-3">
                    <div class="flex flex-row justify-between w-full">
                        <h4 class="bold text-xl md:text-4xl my-auto">New Game</h4>
                        <button x-on:click="$refs.modalCreateGame.close()" class="rounded-full bg-none lg:opacity-50 lg:hover:opacity-100 min-w-0 w-12 h-12 mr-0 text-lg my-auto">
                            X
                        </button>
                    </div>
                    <hr>
                    <div class="min-h-[50hv] h-[10000px] max-h-[60vh] md:max-h-[55vh] relative">
                        <form id="newGameForm" class="flex flex-col gap-4 relative h-full">
                            <div class="flex flex-col md:flex-row w-full justify-between">
                                <label for="new-game-name" class="my-auto">Room Name</label>
                                <div class="w-full md:w-1/2 flex flex-row gap-4">
                                    <input id="new-game-name" x-model="newGame.name" maxlength="32" class="w-full" x-bind:disabled="loading">
                                </div>
                            </div>
                            <div class="flex flex-col md:flex-row w-full justify-between">
                                <label for="new-game-password" class="my-auto">Room Password</label>
                                <div class="w-full md:w-1/2 flex flex-row gap-4">
                                    <input id="new-game-password" x-model="newGame.password" type="password" class="w-full" x-bind:disabled="loading">
                                </div>
                            </div>
                            <div class="flex flex-col md:flex-row w-full justify-between">
                                <label for="new-game-rounds" class="my-auto">Rounds</label>
                                <div class="w-full md:w-1/2 flex flex-row gap-4">
                                    <input id="new-game-rounds" x-model="newGame.rounds" type="range" min="1" max="10" step="1" class="my-auto w-full" x-bind:disabled="loading">
                                    <output for="new-game-rounds" x-text="pad(newGame.rounds)" class="my-auto"></output>
                                </div>
                            </div>
                            <div class="flex flex-col md:flex-row w-full justify-between">
                                <label for="new-game-round_duration" class="my-auto">Round Duration (s)</label>
                                <div class="w-full md:w-1/2 flex flex-row gap-4">
                                    <input id="new-game-round_duration" x-model="newGame.round_duration" type="range" min="60" max="300" step="10" class="my-auto w-full" x-bind:disabled="loading">
                                    <output x-text="pad(newGame.round_duration)" class="my-auto"></output>
                                </div>
                            </div>
                            <div class="flex flex-col md:flex-row w-full justify-between">
                                <label class="my-auto">Max Players</label>
                                <div class="w-full md:w-1/2 flex flex-row gap-4">
                                    <input id="new-game-max_players" x-model="newGame.max_players" type="range" min="5" max="50" step="5" class="my-auto w-full" x-bind:disabled="loading">
                                    <output x-text="pad(newGame.max_players)" class="my-auto"></output>
                                </div>
                            </div>
                        </form>
                        <span class="absolute bottom-3 text-red-500" x-text="newGameErrorMessage"></span>
                    </div>
                    <hr>
                    <div class="w-full flex flex-row justify-between m-auto">
                        <div></div>
                        <button x-bind:disabled="loading" x-on:click="createNewGame()">Create</button>
                    </div>
                </div>
            </div>
        </dialog>

        <dialog x-ref="modalHowToPlay">
            <div class="flex text-white">
                <div class="flex flex-col p-6 w-full h-full gap-2 md:gap-3">
                    <div class="flex flex-row justify-between w-full">
                        <h4 class="bold text-xl md:text-4xl my-auto">How To Play</h4>
                        <button x-on:click="$refs.modalHowToPlay.close()" class="rounded-full bg-none lg:opacity-50 lg:hover:opacity-100 min-w-0 w-12 h-12 mr-0 text-lg">
                            X
                        </button>
                    </div>
                    <hr>
                    <div class="min-h-[50hv] h-[10000px] max-h-[65vh] md:h-fit md:max-h-[55vh] overflow-y-scroll md:overflow-y-auto">
                        <div class="flex flex-col gap-4 relative h-full">
                            <p class="text-base md:text-lg">
                                Hi bubble buddie! Welcome to Very Bubbly Friends! This is a trivia game where players pop bubbles to get questions and compete with others to get the most points.
                            </p>
                            <p class="text-base md:text-lg">
                                Create a game with a device everyone can see, or join a game on any device. When the bubbles come, map your tapping on your device to the bubbles on the screen. When you hit a bubble, a question will come on your device. The bigger the bubble, the harder the question, but the more points you earn! 
                            </p>
                            <p class="text-base md:text-lg">
                                Answer correctly, and you earn points based on the difficuly, but be careful; getting a question wrong will make you lose a point.
                            </p>
                            <p class="text-base md:text-lg">
                                The player with the most points at the end of the game wins!
                            </p>
                        </div>
                    </div>
                    <hr>
                    <div class="w-full flex flex-row justify-between m-auto">
                        <div></div>
                        <button x-on:click="$refs.modalHowToPlay.close()">Close</button>
                    </div>
                </div>
            </div>
        </dialog>

        <dialog x-ref="modalCredits">
            <div class="flex text-white">
                <div class="flex flex-col p-6 w-full h-full gap-2 md:gap-3">
                    <div class="flex flex-row justify-between w-full">
                        <h4 class="bold text-xl md:text-4xl my-auto">Credits</h4>
                        <button x-on:click="$refs.modalCredits.close()" class="rounded-full bg-none lg:opacity-50 lg:hover:opacity-100 min-w-0 w-12 h-12 mr-0 text-lg">
                            X
                        </button>
                    </div>
                    <hr>
                    <div class="min-h-[50hv] h-[10000px] max-h-[60vh] md:max-h-[55vh]">
                        <div class="flex flex-col gap-4 relative h-full">
                            <p class="text-base md:text-xl">
                                Concept and Design: Tyler Johnson
                            </p>
                            <p class="text-base md:text-xl">
                                Programming: Tyler Johnson
                            </p>
                            <p class="text-base md:text-xl">
                                Music and SFX: Tyler Johnson
                            </p>
                            <p class="absolute bottom-0 text-base md:text-xl">
                                Special Thanks to Global Game Jam 2025
                            </p>
                        </div>
                    </div>
                    <hr>
                    <div class="w-full flex flex-row justify-between m-auto">
                        <div></div>
                        <button x-on:click="$refs.modalCredits.close()">Close</button>
                    </div>
                </div>
            </div>
        </dialog>
    </div>

    
    <script src="{{ url_for('static', filename='dist/app.js') }}"></script>
</body>
</html>